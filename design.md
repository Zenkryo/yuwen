# 词语学习应用设计文档

## 1. 应用概述
这是一个基于 Flutter 开发的词语学习应用，主要用于学习和记忆中文词语。应用支持多种学习模式，包括浏览模式和输入模式，并提供了丰富的交互功能。

## 2. 核心功能

### 2.1 词语管理
- 支持从 JSON 文件加载词语数据
- 词语数据结构 (all_words.json) 格式如下：
  ```json
  {
    "词语": {
      "pinyin": ["pinyin1", "pinyin2"],
      "explanation": "词语解释",
      "from": "来源/年级"
    }
  }
  ```
- 支持收藏功能，可保存用户收藏的词语

### 2.2 学习模式
#### 2.2.1 浏览模式
- 显示当前词语
- 支持显示/隐藏拼音
- 支持显示/隐藏解释
- 支持词语朗读功能
- 支持在词语间导航
- 支持在不同来源（年级）间切换

#### 2.2.2 输入模式
- 通过输入拼音来显示汉字
- 支持逐字输入
- 实时显示输入状态
- 支持拼音输入错误修正
- 支持空格键确认当前拼音输入

### 2.3 数据持久化
- 保存用户收藏的词语
- 记录每个来源的最后浏览位置
- 保存当前学习的来源信息

## 3. 用户界面

### 3.1 主界面布局
- 中央显示区域：显示当前词语
- 底部状态栏：显示操作提示
- 右下角：显示当前进度（当前词语/总词语数）

### 3.2 显示元素
- 词语显示：使用楷体字体，大号字体
- 拼音显示：使用等宽字体，灰色显示
- 解释显示：居中显示，适当字体大小
- 收藏标记：使用星形图标表示

## 4. 交互设计

### 4.1 键盘快捷键
#### 浏览模式：
- ESC：进入/退出输入模式
- 空格：朗读当前词语
- P键：显示/隐藏拼音
- X键：显示/隐藏解释
- 左右箭头：切换上一个/下一个词语
- 上下箭头：切换不同来源

#### 输入模式：
- ESC：退出输入模式
- 退格键：删除输入
- 空格键：确认当前拼音输入
- 字母键：输入拼音

### 4.2 语音功能
- 使用 Flutter TTS 实现
- 支持中文朗读
- 可调节语速、音量和音调

## 5. 数据管理

### 5.1 本地存储
- 使用 JSON 格式存储数据，格式如下：
  ```json
  {
    "saved_words": {
      "词语1": {
        "pinyin": ["pinyin1", "pinyin2"],
        "explanation": "解释",
        "from": "来源"
      }
    },
    "current_from": "当前来源",
    "from_last_index": {
      "来源1": 0,
      "来源2": 5
    }
  }
  ```
- 保存位置：应用文档目录
- 存储内容：
  - 收藏的词语
  - 当前来源
  - 每个来源的最后浏览位置

### 5.2 拼音处理
- 支持带声调的拼音
- 提供拼音转换功能
- 支持拼音输入验证

## 6. 技术实现

### 6.1 状态管理
- 使用 StatefulWidget 管理应用状态
- 主要状态包括：
  - 当前词语
  - 显示状态（拼音/解释）
  - 输入模式状态
  - 当前来源
  - 浏览进度

### 6.2 资源管理
- 使用 Flutter 资源系统加载词语数据
- 支持自定义字体
- 使用 Material Design 主题

## 7. 性能考虑
- 使用异步加载处理数据
- 实现状态持久化
- 优化键盘事件处理
- 合理管理内存资源

## 8. 扩展性
- 支持添加新的词语来源
- 可扩展的拼音输入系统
- 可自定义的显示样式
- 可配置的快捷键系统 